# Preparation

* Prepare folders for data storage and results (can be the same folder too, but that may get messy)
  * For data storage a big external (network) drive is recommended, needs lots of space
  * One folder for each of your strains of interest will be generated by the ImageJ split_image script in the data storage folder
  * In the results folder, create the following folders:
	* reversals_phase_contrast folder
	* displacement_maps_speed folder
	* pole2pole_oscillations folder
	* (jpg plots are saved in those folders)
	* each of those folder should also contain the following folders for other file types:
		* mat_files folder
		* svg _files folder
		* fig_files folder

* Make sure all directories in the ImageJ and Matlab scripts are matching your personal system's directories
* You can search for "directory" in the scripts and modify them, but make sure to only modify strings and not change variable names!


# Requirements

 * ImageJ / Fiji - version 1.53 or higher
   * plugins contained in Fiji
   * StackReg plugin (http://bigwww.epfl.ch/thevenaz/stackreg/)
   * TurboReg plugin (http://bigwww.epfl.ch/thevenaz/turboreg/)
   * MultiStackReg plugin (https://biii.eu/multistackreg)
 * Matlab - version R2019b or higher
   * Image Processing Toolbox (https://ch.mathworks.com/products/image.html)
   * Parallel Computing Toolbox (https://ch.mathworks.com/products/parallel-computing.html?s_tid=srchtitle_Parallel%20Processing%20Toolbox_1)
 * BacStalk - version 1.8


# How to run this code

* Graph plotting contains different analysis scripts:
  * **displacement_maps_speed** - Plots the cell tracks as incremental discplacement relative to the initial leading pole, can also plot speed
  * **reversals_phase_contrast** - Plots the frequency of directional changes
  * **pole2pole_oscillations** - Plots the frequency of pole-to-pole switches of the brightest polar fluorescent signal
* They all require basic analysis with ImageJ and BacStalk
  * **Basic_Analysis_Phase** - Run for displacement_maps_speed and reversals_phase_contrast
  * **Basic_Analysis_Fluo** - Run for pole2pole_oscillations
* They all require the same input file (located in graph_plotting) specifying which data to analyse and plot:
	* Data_Input_Graph_Plotting.xlsx (what you enter here must match exactly how your files and folders are organized (i.e. named) by the ImageJ split_image script)
      * each line represents one set of data
      * **column 1** - strain number and name of your strain of interest (name of the folder in the data storage directory)
      * **column 2** - date (name of the folder inside the strain number and name folder)
      * **column 3** - condition (name of the folder inside the date folder)

* Basic Analysis - ImageJ
  * Run the split_image macros (Fiji ImageJ, v1.53, https://fiji.sc/) to prepare for BacStalk analysis
    * **1_split_image.ijm** - for image sequences with first channel phase contrast + second channel fluorescence 
	* For only one phase contrast channel, activate option only_PC=1
	* **1_split_image_twoChannels.ijm** - for image sequences with first channel phase contrast + second channel fluorescence + third channel fluorescence 
	* BacStalk will recognize two fluorescent channels by looking for the file C2-data.tif which is generated by this macro (1_split_image_twoChannels.ijm)
	* Note, second channel is only considered by analysis scripts that require a second channel (non of the above mentioned graph plotting scripts)
  * If image sequences were recorded with very big field of view containing many cells, it can be helpful to split the movie into four section
    * **0_divide_image_onlyPC** - for image sequences with one phase contrast channel only
	* Runs drift correction by default
	* Disable drift correction in the split_image script when using this script

* Basic Analysis - BacStalk
  * Download original BacStalk (v1.8, https://drescherlab.org/data/bacstalk/docs/index.html)
	* Copy content into folder BacStalk_modified
	* Skip files that already exist in the folder
  * Run Basic_Analysis in Matlab (vR2019b or higher)
    * Enter multiple strains, dates and conditions that you want to analyse in the file Data_Input_Basic_Analysis.xlsx
    * **Basic_Analysis_Phase.m** - Only considers the first channel (default phase contrast), can be run for two channel data too, but ignores the fluorescent channel
    * **Basic_Analysis_Fluo.m** - Considers phase contrast (channel 1) and one fluorescent channel (channel 2), can do a second fluorescent channel which is saved as separate cell_prop_ch2 variable in variables.mat
	
* Basic Analysis - ImageJ post-processing and verification of tracking
  * Run **2_make_video.ijm** to combine the images generated by Matlab containing the segmented cells and tracks (copy paste strain input from 1_split_image.ijm)
  * Use **3_open_video.ijm** to open all movies of subfolders of one condition of one date of one strain (you select several condition folders and it will open all movies)
  * **Check every movie for correct segmentation, tracking and separation into moving and non-moving cells**
  * If necessary, change parameters for segmentation, tracking, or speed limit, then rerun the BacStalk analysis (yes, it makes sense to run for one image sequence first to find good parameters)
  
* Graph_plotting
  * Run one of the graph_plotting scripts in Matlab (vR2019b or higher)
  * Enter multiple strains, dates and conditions that you want to analyse in the file Data_Input_Graph_Plotting.xlsx (you can copy past from Data_Input_Basic_Analysis.xlsx)
  * In some scripts you can activate different things to plot or different ways to analyse the data
